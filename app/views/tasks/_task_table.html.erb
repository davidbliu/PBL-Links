<style type = 'text/css'>
.small{
	text-decoration: line-through;
	opacity:0.3;
}
.list-option{
}
.task-list-card{
	/*border:1px solid rgba(0,0,0,0.1);*/
	margin:10px;

	border-radius:5px;

	background-color: rgba(247, 247, 247, 0.85);
	  border-radius:5px;

	  padding: 10px;
}
.text-detail{
	font-size:10px;
}
a.anchor{display: block; position: relative; top: -100px; visibility: hidden;}
</style>

<!-- <table class = 'table table-condensed'> -->
	
	<!-- <tbody> -->
	<ul class = 'list-group'>
		<% board_hash.keys.reverse.each do |board_id| %>
		<% if cards.select{|x| x.board_id == board_id}.length >0 %>
		<li class = 'list-group-item'><a href = '#<%= board_id %>-card-anchor'><%= board_hash[board_id].name %></a></li>
		<% end %>
		<% end %>
	</ul>
	
		
	<% board_hash.keys.reverse.each do |board_id| %>
		<% if cards.select{|x| x.board_id == board_id}.length >0 %>
		<div class = 'task-list-card shadow-z-1'>
			
			<h4><a class="anchor" id = '<%= board_id %>-card-anchor'></a><a href = 'http://trello.com/b/<%= board_id %>' target = '_blank'><%= board_hash[board_id].name %></a></h4>
				<ul class = 'list-group'>
				<% [false, true].each do |state| %>
					<% cards.select{|x| x.board_id == board_id and list_hash[x.list_id].name.include?("Done") == state}.each do |card| %>
						<% if state == true %>
						<li class = 'list-group-item small' id = '<%= card.id %>-row'>
							<div class = 'main-content'>
							<input type="checkbox" class = 'task-checkbox' id = '<%= card.id %>' checked = 'checked'>
						<% else %>
						<li class = 'list-group-item' id = '<%= card.id %>-row'>
							<div class = 'main-content'>
							<input type="checkbox" class = 'task-checkbox' id = '<%= card.id %>'>
						<% end %>
							<a href = '<%= card.url %>' target = '_blank'><%= card.name %></a>
							<% card.card_labels.each do |label| %>
								<div class = 'label label-default' style = 'background-color:<%= label['color'] %>'><%= label['name'] %></div>
							<% end %>
							</div> <!-- end of main-content -->
							<div class = 'text-muted text-detail'><%= ParseTrelloList.due_string(card.due) %></div>
							<div class = 'text-muted text-detail card-description'><%= card.desc %></div>
							<div style = 'display:none' class = 'hidden-card-info'><%= card.to_json %></div>
						</li>
					<% end %>
				<% end %>
				</ul>
		</div>
		<% end %><!-- end of check if there are cards-->
	<% end %>
	<!-- </tbody> -->
<!-- </table> -->


<script type = 'text/javascript'>
function activateTaskCheckbox(){
	$('.task-checkbox').click(function(){

		id = $(this).attr('id');
		row = $('#' + id + '-row');

		card_data = JSON.parse($(row).find('.hidden-card-info').html());
		board_id = card_data.board_id
		list_id = card_data.list_id
		checked = false;
		if ($(this).is(':checked')){
			checked = true;
		}
		console.log(card_data);
		console.log(checked);
		that = $(this);
		$.ajax({
	      url: '/tasks/update',
	      type: 'POST',
	      data: {card_id: card_data.id, list_id: card_data.list_id, board_id: card_data.board_id, checked: checked},
	      success:function(data){
	        //toggle done or not
			if($(row).hasClass('small')){
				$(row).removeClass('small');
			}
			else{
				$(row).addClass('small');
			}
	      },
	      error:function (xhr, textStatus, thrownError){
	      	console.log("errror");
	      	console.log(xhr);
	        $(that).attr('checked', false);
	      }
	  	});

		
	});
}
activateTaskCheckbox();
</script>